<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星空书摘 - 优化版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========================================
           CSS 变量 - 统一主题管理
        ======================================== */
        :root {
            /* 颜色系统 */
            --primary-color: #8b5cf6;
            --primary-hover: #7c3aed;
            --secondary-color: #38bdf8;
            --accent-color: #6366f1;
            --accent-hover: #4f46e5;
            
            /* 背景色 */
            --bg-primary: #0a0e27;
            --bg-secondary: #111836;
            --bg-card: rgba(17, 24, 54, 0.6);
            --bg-card-soft: rgba(17, 24, 54, 0.45);
            --bg-overlay: rgba(0, 0, 0, 0.8);
            
            /* 文字颜色 */
            --text-primary: #f5f7ff;
            --text-secondary: rgba(245, 247, 255, 0.7);
            --text-muted: rgba(245, 247, 255, 0.5);
            
            /* 边框 */
            --border-color: rgba(139, 92, 246, 0.2);
            --border-hover: rgba(139, 92, 246, 0.4);
            
            /* 阴影 */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(99, 102, 241, 0.2);
            
            /* 间距 */
            --spacing-xs: 0.5rem;
            --spacing-sm: 0.75rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            
            /* 圆角 */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 999px;
            
            /* 过渡 */
            --transition-fast: 0.2s ease;
            --transition-base: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* 亮色模式 */
        body.light-mode {
            --bg-primary: #f8f9ff;
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-card-soft: rgba(255, 255, 255, 0.85);
            --bg-overlay: rgba(0, 0, 0, 0.5);
            
            --text-primary: #1a1a2e;
            --text-secondary: rgba(26, 26, 46, 0.7);
            --text-muted: rgba(26, 26, 46, 0.5);
            
            --border-color: rgba(139, 92, 246, 0.15);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        /* ========================================
           全局样式
        ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 
                         'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background var(--transition-base), color var(--transition-base);
        }

        /* ========================================
           容器布局
        ======================================== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }

        /* ========================================
           书摘区域
        ======================================== */
        .reading-digest {
            margin-top: var(--spacing-xl);
        }

        .reading-digest-header {
            display: flex;
            gap: var(--spacing-lg);
            align-items: flex-start;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-xl);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            backdrop-filter: blur(20px);
        }

        .digest-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--radius-lg);
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .reading-digest-header h2 {
            font-size: 1.8rem;
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .reading-digest-header p {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        /* ========================================
           搜索工具栏 - 优化版
        ======================================== */
        .digest-search {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .search-input-wrapper {
            position: relative;
            flex: 1;
            min-width: 280px;
        }

        .digest-search input {
            width: 100%;
            padding: 0.7rem 1.2rem;
            padding-right: 2.5rem;
            border-radius: var(--radius-full);
            border: 1px solid rgba(139, 92, 246, 0.35);
            background: rgba(17, 24, 54, 0.45);
            color: var(--text-primary);
            outline: none;
            transition: all var(--transition-base);
            font-size: 0.95rem;
        }

        body.light-mode .digest-search input {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(139, 92, 246, 0.25);
        }

        .digest-search input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .digest-search input::placeholder {
            color: var(--text-muted);
        }

        /* 搜索图标 */
        .search-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        /* 按钮统一样式 */
        .digest-search button {
            padding: 0.7rem 1.4rem;
            border: none;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.9), rgba(56, 189, 248, 0.85));
            color: white;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            letter-spacing: 0.03em;
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            transition: all var(--transition-base);
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .digest-search button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .digest-search button:hover::before {
            width: 300px;
            height: 300px;
        }

        .digest-search button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(99, 102, 241, 0.35);
        }

        .digest-search button:active {
            transform: translateY(0);
        }

        .digest-search button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* 重置按钮 */
        #digestSearchReset {
            background: rgba(239, 68, 68, 0.9);
        }

        #digestSearchReset:hover {
            box-shadow: 0 12px 24px rgba(239, 68, 68, 0.35);
        }

        /* ========================================
           书摘表格 - 优化版
        ======================================== */
        .reading-digest-table {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .digest-row {
            display: grid;
            grid-template-columns: minmax(220px, 1fr) 2.5fr minmax(90px, 0.8fr) minmax(70px, 0.6fr);
            gap: 1.2rem;
            align-items: start;
            padding: 1.2rem 1.4rem;
            background: var(--bg-card-soft);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            transition: all var(--transition-base);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .digest-row--head {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(56, 189, 248, 0.1));
            font-weight: 600;
            color: var(--accent-hover);
            letter-spacing: 0.05em;
            border-color: rgba(139, 92, 246, 0.3);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .digest-row:hover:not(.digest-row--head) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--border-hover);
        }

        .digest-col {
            word-wrap: break-word;
            word-break: break-word;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .digest-col--book {
            color: var(--accent-color);
            font-weight: 500;
        }

        .digest-col--content {
            color: var(--text-primary);
        }

        /* 搜索高亮 */
        .highlight {
            background: linear-gradient(120deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            padding: 0.1rem 0.2rem;
            border-radius: 3px;
            font-weight: 600;
        }

        .digest-col--date {
            color: var(--text-secondary);
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .digest-col--rating {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ========================================
           评分徽章
        ======================================== */
        .rating-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.4rem 0.8rem;
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: 0.9rem;
            transition: all var(--transition-base);
        }

        .rating-badge:hover {
            transform: scale(1.05);
        }

        .star-icon {
            font-size: 0.8rem;
        }

        .rating-value-9 {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .rating-value-8 {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .rating-value-6 {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .rating-value-4 {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .rating-value-2 {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
        }

        /* ========================================
           状态提示
        ======================================== */
        .empty-state,
        .loading-state {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-lg);
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 1px dashed var(--border-color);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-md);
        }

        .empty-state i,
        .loading-state i {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            color: var(--text-muted);
        }

        .loading-state i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ========================================
           分页控件
        ======================================== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-base);
            font-size: 0.9rem;
        }

        .pagination button:hover:not(:disabled) {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination button.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .pagination-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ========================================
           主题切换按钮
        ======================================== */
        .theme-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-base);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
        }

        /* ========================================
           响应式设计
        ======================================== */
        @media (max-width: 1024px) {
            .digest-row {
                grid-template-columns: 1fr 2fr 0.8fr 0.6fr;
                gap: 0.8rem;
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-md);
            }

            .reading-digest-header {
                flex-direction: column;
                text-align: center;
            }

            .digest-search {
                flex-direction: column;
            }

            .search-input-wrapper {
                min-width: 100%;
            }

            .digest-row {
                grid-template-columns: 1fr;
                gap: 0.6rem;
            }

            .digest-col--date,
            .digest-col--rating {
                justify-self: start;
            }

            .digest-row--head {
                display: none;
            }

            .digest-col::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--accent-color);
                display: block;
                margin-bottom: 0.3rem;
            }
        }

        /* ========================================
           辅助功能优化
        ======================================== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* 键盘焦点样式 */
        *:focus-visible {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <section class="reading-digest">
            <header class="reading-digest-header">
                <div class="digest-icon" aria-hidden="true">
                    <i class="fas fa-star"></i>
                </div>
                <div style="flex: 1;">
                    <h2>星空书摘精选</h2>
                    <p>以下内容由狂客亲自整理，所有更新均通过 GitHub 完成。</p>
                    
                    <!-- 搜索和排序工具栏 -->
                    <div class="digest-search" role="search">
                        <div class="search-input-wrapper">
                            <input 
                                type="search" 
                                id="digestSearchInput" 
                                placeholder="搜索书名或摘录关键词 (Ctrl+K)" 
                                aria-label="搜索书摘"
                                autocomplete="off">
                            <i class="fas fa-search search-icon" aria-hidden="true"></i>
                        </div>
                        <button type="button" id="digestSearchButton" aria-label="执行搜索">
                            <i class="fas fa-search" aria-hidden="true"></i>
                            <span>搜索</span>
                        </button>
                        <button type="button" id="digestSearchReset" aria-label="重置搜索">
                            <i class="fas fa-rotate-left" aria-hidden="true"></i>
                            <span>重置</span>
                        </button>
                        <button type="button" id="digestSortToggle" aria-label="按启发值排序">
                            <i class="fas fa-sort-numeric-down" aria-hidden="true"></i>
                            <span>启发值排序</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 书摘表格 -->
            <div class="reading-digest-table" role="table" aria-label="书摘列表">
                <!-- 表头 -->
                <div class="digest-row digest-row--head" role="row">
                    <div class="digest-col digest-col--book" role="columnheader">书名</div>
                    <div class="digest-col digest-col--content" role="columnheader">摘录</div>
                    <div class="digest-col digest-col--date" role="columnheader">日期</div>
                    <div class="digest-col digest-col--rating" role="columnheader">启发值</div>
                </div>
                <!-- 数据行将通过 JavaScript 动态生成 -->
            </div>

            <!-- 分页控件 -->
            <div class="pagination" id="paginationContainer">
                <!-- 分页按钮将通过 JavaScript 动态生成 -->
            </div>
        </section>
    </div>

    <!-- 主题切换按钮 -->
    <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
        <i class="fas fa-moon"></i>
    </button>

    <script>
        // ========================================
        // 配置常量
        // ========================================
        const CONFIG = {
            ITEMS_PER_PAGE: 10,
            DEBOUNCE_DELAY: 300,
            STORAGE_KEY: {
                THEME: 'digest-theme',
                SORT_ORDER: 'digest-sort-order'
            }
        };

        // ========================================
        // 模拟数据 (实际应从 data.js 加载)
        // ========================================
        const digestData = [
            {
                book: '《万维刚精英日课1~5》',
                content: '最好的失败,就是"在没有人看见的时候偷偷跌倒";我的失败不是我的成功之母,但是别人的失败则可能是我的成功之母',
                date: '2025/10/15',
                rating: 7
            },
            {
                book: '《财富自由之路》',
                content: '只要我投入时间和精力,从长期看,没有什么是我学不会的;我不应该与别人争辩,因为我不想伤害他们;我也不应该被他们影响,因为我不想伤害自己',
                date: '2025/10/15',
                rating: 9
            },
            {
                book: '《马斯克传》',
                content: '当你面临困难时,要么选择放弃,要么选择坚持。坚持下去的人最终会看到曙光。',
                date: '2025/10/14',
                rating: 8
            },
            {
                book: '《深度工作》',
                content: '在一个充满干扰的世界里,专注力是稀缺资源。掌握深度工作的能力,就掌握了成功的钥匙。',
                date: '2025/10/13',
                rating: 9
            },
            {
                book: '《思考,快与慢》',
                content: '我们的大脑有两个系统:系统1快速、直觉;系统2缓慢、理性。了解它们如何工作,才能做出更好的决策。',
                date: '2025/10/12',
                rating: 10
            },
            {
                book: '《原则》',
                content: '拥抱现实,应对现实。痛苦+反思=进步。',
                date: '2025/10/11',
                rating: 8
            },
            {
                book: '《纳瓦尔宝典》',
                content: '财富自由不是拥有更多的钱,而是拥有更多的时间自由。',
                date: '2025/10/10',
                rating: 7
            },
            {
                book: '《刻意练习》',
                content: '天才不是天生的,而是通过正确的练习方法培养出来的。',
                date: '2025/10/09',
                rating: 6
            },
            {
                book: '《影响力》',
                content: '说服他人的关键不是强硬的论证,而是理解人性的弱点。',
                date: '2025/10/08',
                rating: 5
            },
            {
                book: '《非暴力沟通》',
                content: '观察而非评论,感受而非想法,需要而非策略,请求而非命令。',
                date: '2025/10/07',
                rating: 4
            },
            {
                book: '《人类简史》',
                content: '智人之所以能够统治地球,是因为我们能够创造和相信虚构的故事。',
                date: '2025/10/06',
                rating: 9
            },
            {
                book: '《乌合之众》',
                content: '群体永远徘徊在无意识的领域,会随时听命于一切暗示。',
                date: '2025/10/05',
                rating: 7
            }
        ];

        // ========================================
        // 工具函数模块
        // ========================================
        const Utils = {
            /**
             * 防抖函数
             * @param {Function} func - 要执行的函数
             * @param {number} delay - 延迟时间(毫秒)
             * @returns {Function}
             */
            debounce(func, delay) {
                let timeoutId;
                return function(...args) {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => func.apply(this, args), delay);
                };
            },

            /**
             * 高亮搜索关键词
             * @param {string} text - 原文本
             * @param {string} keyword - 关键词
             * @returns {string}
             */
            highlightText(text, keyword) {
                if (!keyword.trim()) return text;
                const regex = new RegExp(`(${keyword})`, 'gi');
                return text.replace(regex, '<span class="highlight">$1</span>');
            },

            /**
             * 获取评分样式类
             * @param {number} rating - 评分值
             * @returns {string}
             */
            getRatingClass(rating) {
                if (rating >= 9) return 'rating-value-9';
                if (rating >= 7) return 'rating-value-8';
                if (rating >= 5) return 'rating-value-6';
                if (rating >= 3) return 'rating-value-4';
                if (rating >= 1) return 'rating-value-2';
                return 'rating-empty';
            },

            /**
             * 保存到本地存储
             * @param {string} key - 键名
             * @param {*} value - 值
             */
            saveToStorage(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error('保存到本地存储失败:', error);
                }
            },

            /**
             * 从本地存储读取
             * @param {string} key - 键名
             * @param {*} defaultValue - 默认值
             * @returns {*}
             */
            loadFromStorage(key, defaultValue) {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (error) {
                    console.error('从本地存储读取失败:', error);
                    return defaultValue;
                }
            }
        };

        // ========================================
        // 数据管理模块
        // ========================================
        const DataManager = {
            originalData: [...digestData],
            filteredData: [...digestData],
            currentPage: 1,
            itemsPerPage: CONFIG.ITEMS_PER_PAGE,
            currentSearchTerm: '',
            currentSortOrder: Utils.loadFromStorage(CONFIG.STORAGE_KEY.SORT_ORDER, 'desc'),

            /**
             * 搜索数据
             * @param {string} searchTerm - 搜索关键词
             */
            search(searchTerm) {
                this.currentSearchTerm = searchTerm.toLowerCase().trim();
                this.currentPage = 1;

                if (!this.currentSearchTerm) {
                    this.filteredData = [...this.originalData];
                } else {
                    this.filteredData = this.originalData.filter(item =>
                        item.book.toLowerCase().includes(this.currentSearchTerm) ||
                        item.content.toLowerCase().includes(this.currentSearchTerm)
                    );
                }

                this.applyCurrentSort();
            },

            /**
             * 排序数据
             */
            toggleSort() {
                this.currentSortOrder = this.currentSortOrder === 'desc' ? 'asc' : 'desc';
                Utils.saveToStorage(CONFIG.STORAGE_KEY.SORT_ORDER, this.currentSortOrder);
                this.applyCurrentSort();
            },

            /**
             * 应用当前排序
             */
            applyCurrentSort() {
                this.filteredData.sort((a, b) => {
                    return this.currentSortOrder === 'desc' 
                        ? b.rating - a.rating 
                        : a.rating - b.rating;
                });
            },

            /**
             * 重置数据
             */
            reset() {
                this.filteredData = [...this.originalData];
                this.currentSearchTerm = '';
                this.currentPage = 1;
            },

            /**
             * 获取当前页数据
             * @returns {Array}
             */
            getCurrentPageData() {
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                return this.filteredData.slice(startIndex, endIndex);
            },

            /**
             * 获取总页数
             * @returns {number}
             */
            getTotalPages() {
                return Math.ceil(this.filteredData.length / this.itemsPerPage);
            },

            /**
             * 设置当前页
             * @param {number} page - 页码
             */
            setCurrentPage(page) {
                const totalPages = this.getTotalPages();
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    return true;
                }
                return false;
            }
        };

        // ========================================
        // UI渲染模块
        // ========================================
        const UIRenderer = {
            /**
             * 渲染书摘表格
             */
            renderDigestTable() {
                const table = document.querySelector('.reading-digest-table');
                const headerRow = table.querySelector('.digest-row--head');
                const currentData = DataManager.getCurrentPageData();

                // 清空现有数据行
                table.innerHTML = '';
                table.appendChild(headerRow);

                // 显示加载状态
                if (currentData.length === 0) {
                    this.showEmptyState(table);
                    return;
                }

                // 渲染数据行
                currentData.forEach((item, index) => {
                    const row = this.createDigestRow(item, index);
                    table.appendChild(row);
                });
            },

            /**
             * 创建书摘行
             * @param {Object} item - 书摘数据
             * @param {number} index - 索引
             * @returns {HTMLElement}
             */
            createDigestRow(item, index) {
                const row = document.createElement('div');
                row.className = 'digest-row';
                row.setAttribute('role', 'row');
                row.style.animationDelay = `${index * 0.05}s`;

                const ratingClass = Utils.getRatingClass(item.rating);
                const highlightedBook = Utils.highlightText(item.book, DataManager.currentSearchTerm);
                const highlightedContent = Utils.highlightText(item.content, DataManager.currentSearchTerm);

                row.innerHTML = `
                    <div class="digest-col digest-col--book" role="cell" data-label="书名">${highlightedBook}</div>
                    <div class="digest-col digest-col--content" role="cell" data-label="摘录">${highlightedContent}</div>
                    <div class="digest-col digest-col--date" role="cell" data-label="日期">${item.date}</div>
                    <div class="digest-col digest-col--rating" role="cell" data-label="启发值">
                        <span class="rating-badge ${ratingClass}" aria-label="启发值${item.rating}分">
                            ${item.rating}<i class="fas fa-star star-icon" aria-hidden="true"></i>
                        </span>
                    </div>
                `;

                return row;
            },

            /**
             * 显示空状态
             * @param {HTMLElement} container - 容器元素
             */
            showEmptyState(container) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-inbox" aria-hidden="true"></i>
                    <p>未找到匹配的书摘</p>
                    <small>尝试使用其他关键词搜索</small>
                `;
                container.appendChild(emptyState);
            },

            /**
             * 渲染分页控件
             */
            renderPagination() {
                const container = document.getElementById('paginationContainer');
                const totalPages = DataManager.getTotalPages();
                const currentPage = DataManager.currentPage;

                if (totalPages <= 1) {
                    container.innerHTML = '';
                    return;
                }

                let html = `
                    <button ${currentPage === 1 ? 'disabled' : ''} data-page="prev" aria-label="上一页">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;

                // 智能显示页码
                const pageRange = this.getPageRange(currentPage, totalPages);
                pageRange.forEach(page => {
                    if (page === '...') {
                        html += `<span class="pagination-ellipsis">...</span>`;
                    } else {
                        html += `
                            <button 
                                ${page === currentPage ? 'class="active"' : ''} 
                                data-page="${page}"
                                aria-label="第${page}页"
                                ${page === currentPage ? 'aria-current="page"' : ''}>
                                ${page}
                            </button>
                        `;
                    }
                });

                html += `
                    <button ${currentPage === totalPages ? 'disabled' : ''} data-page="next" aria-label="下一页">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <span class="pagination-info">共 ${DataManager.filteredData.length} 条</span>
                `;

                container.innerHTML = html;
            },

            /**
             * 获取页码范围
             * @param {number} current - 当前页
             * @param {number} total - 总页数
             * @returns {Array}
             */
            getPageRange(current, total) {
                const delta = 2;
                const range = [];
                const rangeWithDots = [];

                for (let i = 1; i <= total; i++) {
                    if (i === 1 || i === total || (i >= current - delta && i <= current + delta)) {
                        range.push(i);
                    }
                }

                let prev;
                for (const i of range) {
                    if (prev) {
                        if (i - prev === 2) {
                            rangeWithDots.push(prev + 1);
                        } else if (i - prev !== 1) {
                            rangeWithDots.push('...');
                        }
                    }
                    rangeWithDots.push(i);
                    prev = i;
                }

                return rangeWithDots;
            },

            /**
             * 更新排序按钮
             */
            updateSortButton() {
                const button = document.getElementById('digestSortToggle');
                const iconClass = DataManager.currentSortOrder === 'desc' 
                    ? 'fa-sort-numeric-down' 
                    : 'fa-sort-numeric-up';
                
                button.innerHTML = `
                    <i class="fas ${iconClass}" aria-hidden="true"></i>
                    <span>启发值排序</span>
                `;
            },

            /**
             * 完整渲染
             */
            render() {
                this.renderDigestTable();
                this.renderPagination();
                this.updateSortButton();
            }
        };

        // ========================================
        // 事件处理模块
        // ========================================
        const EventHandler = {
            /**
             * 初始化所有事件监听器
             */
            init() {
                this.initSearchEvents();
                this.initPaginationEvents();
                this.initThemeToggle();
                this.initKeyboardShortcuts();
            },

            /**
             * 初始化搜索相关事件
             */
            initSearchEvents() {
                const searchInput = document.getElementById('digestSearchInput');
                const searchButton = document.getElementById('digestSearchButton');
                const resetButton = document.getElementById('digestSearchReset');
                const sortButton = document.getElementById('digestSortToggle');

                // 搜索输入 - 防抖处理
                const debouncedSearch = Utils.debounce(() => {
                    DataManager.search(searchInput.value);
                    UIRenderer.render();
                }, CONFIG.DEBOUNCE_DELAY);

                searchInput.addEventListener('input', debouncedSearch);

                // 搜索按钮
                searchButton.addEventListener('click', () => {
                    DataManager.search(searchInput.value);
                    UIRenderer.render();
                });

                // 回车搜索
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        DataManager.search(searchInput.value);
                        UIRenderer.render();
                    }
                });

                // 重置按钮
                resetButton.addEventListener('click', () => {
                    searchInput.value = '';
                    DataManager.reset();
                    UIRenderer.render();
                    searchInput.focus();
                });

                // 排序按钮
                sortButton.addEventListener('click', () => {
                    DataManager.toggleSort();
                    UIRenderer.render();
                });
            },

            /**
             * 初始化分页事件
             */
            initPaginationEvents() {
                document.getElementById('paginationContainer').addEventListener('click', (e) => {
                    const button = e.target.closest('button[data-page]');
                    if (!button) return;

                    const page = button.dataset.page;
                    let newPage;

                    if (page === 'prev') {
                        newPage = DataManager.currentPage - 1;
                    } else if (page === 'next') {
                        newPage = DataManager.currentPage + 1;
                    } else {
                        newPage = parseInt(page);
                    }

                    if (DataManager.setCurrentPage(newPage)) {
                        UIRenderer.render();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            },

            /**
             * 初始化主题切换
             */
            initThemeToggle() {
                const themeToggle = document.getElementById('themeToggle');
                const savedTheme = Utils.loadFromStorage(CONFIG.STORAGE_KEY.THEME, 'dark');

                // 应用保存的主题
                if (savedTheme === 'light') {
                    document.body.classList.add('light-mode');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }

                themeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('light-mode');
                    const isLight = document.body.classList.contains('light-mode');
                    
                    themeToggle.innerHTML = isLight 
                        ? '<i class="fas fa-sun"></i>' 
                        : '<i class="fas fa-moon"></i>';
                    
                    Utils.saveToStorage(CONFIG.STORAGE_KEY.THEME, isLight ? 'light' : 'dark');
                });
            },

            /**
             * 初始化键盘快捷键
             */
            initKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + K: 聚焦搜索框
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        document.getElementById('digestSearchInput').focus();
                    }

                    // Esc: 清空搜索
                    if (e.key === 'Escape') {
                        const searchInput = document.getElementById('digestSearchInput');
                        if (document.activeElement === searchInput) {
                            searchInput.value = '';
                            DataManager.reset();
                            UIRenderer.render();
                        }
                    }
                });
            }
        };

        // ========================================
        // 应用初始化
        // ========================================
        const App = {
            init() {
                try {
                    // 应用初始排序
                    DataManager.applyCurrentSort();
                    
                    // 初始渲染
                    UIRenderer.render();
                    
                    // 初始化事件
                    EventHandler.init();

                    console.log('✅ 应用初始化成功');
                } catch (error) {
                    console.error('❌ 应用初始化失败:', error);
                    this.showError();
                }
            },

            showError() {
                const table = document.querySelector('.reading-digest-table');
                table.innerHTML = `
                    <div class="empty-state" style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">
                        <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                        <p style="color: #ef4444;">加载失败</p>
                        <small>请刷新页面重试</small>
                    </div>
                `;
            }
        };

        // 页面加载完成后初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => App.init());
        } else {
            App.init();
        }
    </script>
</body>
</html>
