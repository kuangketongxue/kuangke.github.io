<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>狂客·银河 - 探索你的星辰大海</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- LeanCloud SDK - 放在head中 -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-min.js"></script>
    
    <style>
        /* AI前沿按钮专属样式 */
        .ai-nav-button {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            font-weight: 600;
        }
        .ai-nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        .ai-nav-button:hover::before {
            left: 100%;
        }
        .ai-nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        .ai-nav-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        .ai-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            margin-right: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .ai-nav-button:hover .ai-icon {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        .ai-text {
            font-size: 14px;
            letter-spacing: 0.5px;
        }
        /* 为AI按钮添加呼吸动画效果 */
        @keyframes ai-glow {
            0%, 100% { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.6); }
        }
        .ai-nav-button {
            animation: ai-glow 3s ease-in-out infinite;
        }
        /* 统一图标大小和颜色 */
        .success-icon, .sky-icon, .ai-icon, .exam-icon {
            color: #fff;
            font-size: 16px;
        }
        /* 朋友圈样式 */
        .moments-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }
        .moment-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .moment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        .moment-header {
            display: flex;
            align-items: center;
            padding: 16px;
        }
        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 12px;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .moment-content {
            padding: 0 16px 16px;
        }
        .moment-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        .moment-images img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }
        .moment-footer {
            padding: 12px 16px;
            border-top: 1px solid #f0f0f0;
        }
        .moment-stats {
            display: flex;
            gap: 24px;
        }
        .stat-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
            transition: color 0.3s ease;
        }
        .stat-btn:hover {
            color: #3b82f6;
        }
        .stat-btn.liked {
            color: #ef4444;
        }
        /* 添加加载状态样式 */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            color: var(--text-secondary, #666);
        }
        .loading-spinner::after {
            content: '';
            width: 24px;
            height: 24px;
            margin-left: 12px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary, #666);
            font-size: 1.1rem;
        }
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .notification {
            background: #3b82f6;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            animation: notificationSlideIn 0.3s ease-out;
            max-width: 300px;
            word-break: break-word;
        }
        .notification-success { background: #10b981; }
        .notification-warning { background: #f59e0b; }
        .notification-error { background: #ef4444; }
        @keyframes notificationSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes notificationSlideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        .notification-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            opacity: 0.7;
            padding: 4px;
            border-radius: 4px;
            transition: opacity 0.2s;
        }
        .notification-close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
        }
        /* 分类按钮样式 */
        .category-btn {
            padding: 8px 16px;
            border: none;
            background: #f3f4f6;
            color: #666;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .category-btn.active {
            background: #3b82f6;
            color: white;
        }
        .category-btn:hover {
            background: #e5e7eb;
        }
        .category-btn.active:hover {
            background: #2563eb;
        }
    </style>
</head>
<body data-page="moments">
    <header class="header">
        <div class="container">
            <div class="header-left">
                <h1 class="logo">狂客·银河</h1>
                <nav class="main-nav">
                    <a class="success-link" href="success.html">
                        <span class="success-icon">
                            <i class="fas fa-meteor"></i>
                        </span>
                        <span class="success-text">成功日记</span>
                    </a>
                    <a class="sky-link" href="reading.html">
                        <span class="sky-icon">
                            <i class="fas fa-star"></i>
                        </span>
                        <span class="sky-text">星空</span>
                    </a>
                    <a class="ai-nav-button" href="ai.html">
                        <span class="ai-icon">
                            <i class="fas fa-robot"></i>
                        </span>
                        <span class="ai-text">AI前沿</span>
                    </a>
                    <a class="exam-link" href="exam.html">
                        <span class="exam-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </span>
                        <span class="exam-text">考试相关</span>
                    </a>
                </nav>
            </div>
            <div class="controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="搜索银河中...">
                </div>
                <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>
    
    <nav class="category-nav">
        <div class="container">
            <div class="category-scroll">
                <button class="category-btn active" data-category="all">全部</button>
                <button class="category-btn" data-category="生活日常">生活日常</button>
                <button class="category-btn" data-category="美食分享">美食分享</button>
                <button class="category-btn" data-category="旅行见闻">旅行见闻</button>
                <button class="category-btn" data-category="工作相关">工作相关</button>
                <button class="category-btn" data-category="学习成长">学习成长</button>
                <button class="category-btn" data-category="健身运动">健身运动</button>
                <button class="category-btn" data-category="时尚穿搭">时尚穿搭</button>
                <button class="category-btn" data-category="艺术文化">艺术文化</button>
                <button class="category-btn" data-category="情感表达">情感表达</button>
                <button class="category-btn" data-category="节日纪念">节日纪念</button>
                <button class="category-btn" data-category="公益环保">公益环保</button>
                <button class="category-btn" data-category="科技数码">科技数码</button>
                <button class="category-btn" data-category="财经理财">财经理财</button>
                <button class="category-btn" data-category="幽默段子">幽默段子</button>
                <button class="category-btn" data-category="问答互动">问答互动</button>
            </div>
        </div>
    </nav>
    
    <main class="main-content">
        <div class="container">
            <div id="momentsContainer" class="moments-grid">
                <!-- 动态加载的内容将在这里显示 -->
                <div class="loading-spinner">正在加载内容</div>
            </div>
        </div>
    </main>
    
    <footer class="social-footer">
        <div class="container">
            <div class="social-links">
                <a href="https://open.weixin.qq.com/qr/code?username=gh_ba5b6bb6bd89"
                   target="_blank" class="social-link wechat" title="微信公众号" rel="noopener noreferrer">
                    <i class="fab fa-weixin"></i>
                </a>
                <a href="https://github.com/kuangketongxue" target="_blank" class="social-link github" title="GitHub" rel="noopener noreferrer">
                    <i class="fab fa-github"></i>
                </a>
                <a href="https://x.com/kuangketongxue" target="_blank" class="social-link x" title="X (前 Twitter)" rel="noopener noreferrer">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </a>
            </div>
            <p class="copyright">© 2025 狂客·银河 版权所有</p>
        </div>
    </footer>
    
    <!-- 评论弹窗 -->
    <div id="commentModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="commentModalTitle" style="display: none;">
        <div class="modal-content">
            <span class="close" aria-label="关闭评论弹窗">&times;</span>
            <h2 id="commentModalTitle">评论</h2>
            <div id="commentsList" class="comments-list">
                <!-- 评论将在这里动态加载 -->
            </div>
            <div class="comment-input-area">
                <label for="commentInput" class="sr-only">输入你的评论</label>
                <input type="text" id="commentInput" placeholder="写下你的评论..." aria-label="评论输入框">
                <button id="submitComment">发送</button>
            </div>
        </div>
    </div>

    <!-- 脚本按正确顺序加载 -->
 <script src="config.js"></script>
<script src="success-diary-data.js"></script>
<script src="utils.js"></script>
<script src="script.js"></script>
    
    <!-- 使用简化的朋友圈脚本 -->
   
         

            renderMoments(moments) {
                const container = document.getElementById('momentsContainer');
                if (!container) return;

                if (!moments || moments.length === 0) {
                    container.innerHTML = '<div class="no-results">暂无内容</div>';
                    return;
                }

                container.innerHTML = '';
                moments.forEach(moment => {
                    const momentCard = this.createMomentCard(moment);
                    container.appendChild(momentCard);
                });
            }

            createMomentCard(moment) {
                const card = document.createElement('div');
                card.className = 'moment-card';
                card.dataset.category = moment.category;
                card.dataset.id = moment.id;
                
                const imagesHtml = moment.images && moment.images.length > 0 ? `
                    <div class="moment-images">
                        ${moment.images.map((img, index) => `
                            <img src="${img}" alt="分享图片${index + 1}" style="max-width: 100%; border-radius: 8px;">
                        `).join('')}
                    </div>
                ` : '';

                card.innerHTML = `
                    <div class="moment-header">
                        <div class="user-avatar">
                            <img src="${moment.avatar}" alt="${moment.username}" style="width: 48px; height: 48px; border-radius: 50%; object-fit: cover;">
                        </div>
                        <div class="user-info">
                            <h3 class="username" style="margin: 0; font-size: 16px;">${moment.username}</h3>
                            <span class="timestamp" style="color: #999; font-size: 12px;">${moment.timestamp}</span>
                        </div>
                        <div class="moment-actions">
                            <button class="moment-menu" style="background: none; border: none; cursor: pointer;">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                    </div>
                    <div class="moment-content" style="padding: 0 16px 16px;">
                        <p class="moment-text" style="margin: 8px 0;">${moment.content}</p>
                        ${imagesHtml}
                    </div>
                    <div class="moment-footer" style="padding: 12px 16px; border-top: 1px solid #f0f0f0;">
                        <div class="moment-stats" style="display: flex; gap: 24px;">
                            <button class="stat-btn like-btn ${moment.isLiked ? 'liked' : ''}" 
                                    data-liked="${moment.isLiked}" 
                                    data-id="${moment.id}"
                                    style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 6px; color: #666;">
                                <i class="${moment.isLiked ? 'fas' : 'far'} fa-heart"></i>
                                <span class="like-count">${moment.likes || 0}</span>
                            </button>
                            <button class="stat-btn comment-btn" data-id="${moment.id}"
                                    style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 6px; color: #666;">
                                <i class="far fa-comment"></i>
                                <span class="comment-count">${moment.comments || 0}</span>
                            </button>
                            <button class="stat-btn share-btn"
                                    style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 6px; color: #666;">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                return card;
            }

            async filterByCategory(category) {
                console.log('筛选分类:', category);
                this.currentCategory = category;
                
                // 更新按钮状态
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeBtn = document.querySelector(`[data-category="${category}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }

                const container = document.getElementById('momentsContainer');
                container.innerHTML = '<div class="loading-spinner">正在加载内容</div>';

                try {
                    if (category === 'all') {
                        this.renderMoments(this.moments);
                    } else {
                        const filtered = this.moments.filter(moment => moment.category === category);
                        this.renderMoments(filtered);
                    }
                } catch (error) {
                    console.error('分类加载失败:', error);
                    container.innerHTML = '<div class="no-results">加载失败，请刷新重试</div>';
                }
            }

            handleLike(btn) {
                const isLiked = btn.dataset.liked === 'true';
                const heartIcon = btn.querySelector('i');
                const countSpan = btn.querySelector('.like-count');
                let count = parseInt(countSpan.textContent);

                if (isLiked) {
                    btn.dataset.liked = 'false';
                    heartIcon.className = 'far fa-heart';
                    btn.classList.remove('liked');
                    count--;
                    this.showNotification('取消点赞');
                } else {
                    btn.dataset.liked = 'true';
                    heartIcon.className = 'fas fa-heart';
                    btn.classList.add('liked');
                    count++;
                    this.showNotification('点赞成功');
                }
                
                countSpan.textContent = count;
            }

            handleShare() {
                if (navigator.share) {
                    navigator.share({
                        title: '狂客·银河朋友圈',
                        text: '看看我分享的内容',
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href);
                    this.showNotification('链接已复制到剪贴板');
                }
            }

            searchMoments(keyword) {
                if (!keyword.trim()) {
                    this.renderMoments(this.moments);
                    return;
                }

                const filtered = this.moments.filter(moment => 
                    moment.content.toLowerCase().includes(keyword.toLowerCase()) ||
                    moment.username.toLowerCase().includes(keyword.toLowerCase())
                );
                
                this.renderMoments(filtered);
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#10b981' : '#3b82f6'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // 立即创建并暴露到全局
        console.log('创建朋友圈应用实例...');
        window.momentsApp = new SimpleMomentsApp();

        // 等待DOM加载完成后初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM加载完成，初始化应用...');
                window.momentsApp.init();
            });
        } else {
            console.log('DOM已加载，立即初始化应用...');
            setTimeout(() => window.momentsApp.init(), 100);
        }

        console.log('朋友圈脚本加载完成');
    </script>
    
    <!-- 其他项目脚本 -->
    <script src="data.js"></script>
    <script src="script.js"></script>
</body>
</html>
