<!-- å¥åº·æé†’åŠŸèƒ½è„šæœ¬ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼‰ -->
<script>
    // å¥åº·æé†’ç®¡ç†å™¨ - ä¿®å¤ç‰ˆæœ¬
    (function() {
        'use strict';
        class HealthReminderManager {
            constructor() {
                this.isActive = false;
                this.breakInterval = null;
                this.eyeCareInterval = null;
                this.eyeCareTimer = null;
                this.eyeCareDuration = 5 * 60 * 1000; // 5åˆ†é’Ÿçœ¼ä¿å¥æ“æ—¶é—´
                this.isDoingEyeCare = false;
                this.currentNotificationType = null;
                this.backgroundModeEnabled = false;
                this.audioManager = new AudioManager();
                this.userInteracted = false; // ç”¨æˆ·æ˜¯å¦å·²äº¤äº’
                this.isNotificationAnimating = false; // é˜²æ­¢é‡å¤ç‚¹å‡»åŠ¨ç”»
                this.clickCooldown = false; // ç‚¹å‡»å†·å´æ—¶é—´
                this.init();
            }
            
            init() {
                // ç­‰å¾…DOMåŠ è½½å®Œæˆ
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.setupEventListeners());
                } else {
                    this.setupEventListeners();
                }
                // ç›‘å¬ç”¨æˆ·äº¤äº’äº‹ä»¶
                this.setupUserInteractionListeners();
            }
            
            // è®¾ç½®ç”¨æˆ·äº¤äº’ç›‘å¬å™¨
            setupUserInteractionListeners() {
                const interactionEvents = [
                    'click', 'keydown', 'touchstart', 'mousedown'
                ];
                interactionEvents.forEach(eventType => {
                    document.addEventListener(eventType, () => {
                        if (!this.userInteracted) {
                            this.userInteracted = true;
                            this.audioManager.initializeAudio();
                            console.log('ç”¨æˆ·å·²äº¤äº’ï¼ŒéŸ³é¢‘ç³»ç»Ÿå·²å¯ç”¨');
                        }
                    }, { once: false });
                });
            }
            
            setupEventListeners() {
                // è·å–DOMå…ƒç´ 
                this.healthBtn = document.getElementById('healthReminderBtn');
                this.notification = document.getElementById('healthNotification');
                this.permissionBanner = document.getElementById('permissionBanner');
                this.audioPermissionBanner = document.getElementById('audioPermissionBanner');
                
                // ç»‘å®šé€šçŸ¥å…ƒç´ 
                this.notificationTitle = document.getElementById('notificationTitle');
                this.notificationContent = document.getElementById('notificationContent');
                this.notificationClose = document.getElementById('notificationClose');
                this.notificationConfirm = document.getElementById('notificationConfirm');
                this.notificationSnooze = document.getElementById('notificationSnooze');
                
                // æƒé™æŒ‰é’®
                this.allowBackgroundBtn = document.getElementById('allowBackgroundBtn');
                this.denyBackgroundBtn = document.getElementById('denyBackgroundBtn');
                
                // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!this.healthBtn || !this.notification) {
                    console.warn('å¥åº·æé†’åŠŸèƒ½å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                // ç»‘å®šäº‹ä»¶ - ä¼˜åŒ–ç‚¹å‡»äº¤äº’
                this.healthBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.handleHealthButtonClick(e);
                });
                
                // æ·»åŠ æŒ‰é’®æ‚¬åœæ•ˆæœ
                this.healthBtn.addEventListener('mouseenter', () => {
                    if (!this.isActive) {
                        this.healthBtn.style.transform = 'translateY(-2px) scale(1.02)';
                    }
                });
                
                this.healthBtn.addEventListener('mouseleave', () => {
                    if (!this.isNotificationAnimating) {
                        this.healthBtn.style.transform = '';
                    }
                });
                
                // é€šçŸ¥æŒ‰é’®äº‹ä»¶ - æ·»åŠ åé¦ˆåŠ¨ç”»
                this.notificationClose.addEventListener('click', (e) => {
                    this.addClickFeedback(e.target);
                    this.handleClose();
                });
                
                this.notificationConfirm.addEventListener('click', (e) => {
                    this.addClickFeedback(e.target);
                    this.handleConfirm();
                });
                
                this.notificationSnooze.addEventListener('click', (e) => {
                    this.addClickFeedback(e.target);
                    this.handleSnooze();
                });
                
                // æƒé™è¯·æ±‚äº‹ä»¶ - æ·»åŠ åé¦ˆ
                this.allowBackgroundBtn.addEventListener('click', (e) => {
                    this.addClickFeedback(e.target);
                    this.enableBackgroundMode();
                });
                
                this.denyBackgroundBtn.addEventListener('click', (e) => {
                    this.addClickFeedback(e.target);
                    this.hidePermissionBanner();
                });
                
                // è¯·æ±‚é€šçŸ¥æƒé™
                this.requestNotificationPermission();
                
                // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
                document.addEventListener('visibilitychange', () => this.handleVisibilityChange());
                
                // ç›‘å¬ Service Worker æ¶ˆæ¯
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.addEventListener('message', (event) => {
                        this.handleServiceWorkerMessage(event.data);
                    });
                }
                
                // ä»localStorageæ¢å¤çŠ¶æ€
                this.restoreState();
            }
            
            // æ·»åŠ ç‚¹å‡»åé¦ˆæ•ˆæœ
            addClickFeedback(element) {
                if (this.clickCooldown) return;
                this.clickCooldown = true;
                
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
                element.style.transform = 'scale(0.95)';
                element.style.transition = 'transform 0.1s ease';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    this.clickCooldown = false;
                }, 150);
                
                // æ·»åŠ æ¶Ÿæ¼ªæ•ˆæœ
                this.createRippleEffect(element);
            }
            
            // åˆ›å»ºæ¶Ÿæ¼ªæ•ˆæœ
            createRippleEffect(element) {
                const ripple = document.createElement('span');
                ripple.style.position = 'absolute';
                ripple.style.borderRadius = '50%';
                ripple.style.background = 'rgba(255, 255, 255, 0.5)';
                ripple.style.width = '20px';
                ripple.style.height = '20px';
                ripple.style.animation = 'ripple 0.6s ease-out';
                ripple.style.pointerEvents = 'none';
                
                const rect = element.getBoundingClientRect();
                ripple.style.left = '50%';
                ripple.style.top = '50%';
                ripple.style.transform = 'translate(-50%, -50%)';
                
                element.style.position = 'relative';
                element.style.overflow = 'hidden';
                element.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            }
            
            // å¤„ç†å¥åº·æé†’æŒ‰é’®ç‚¹å‡» - ä¼˜åŒ–ç‰ˆæœ¬
            handleHealthButtonClick(event) {
                // é˜²æ­¢é‡å¤ç‚¹å‡»
                if (this.isNotificationAnimating) return;
                
                // ç”¨æˆ·äº¤äº’äº‹ä»¶ï¼Œåˆå§‹åŒ–éŸ³é¢‘
                if (!this.userInteracted) {
                    this.userInteracted = true;
                    this.audioManager.initializeAudio();
                    this.hideAudioPermissionBanner();
                }
                
                // æ·»åŠ æŒ‰é’®ç‚¹å‡»åŠ¨ç”»
                this.isNotificationAnimating = true;
                this.healthBtn.style.transform = 'scale(0.95)';
                this.healthBtn.style.transition = 'transform 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                
                // åˆ›å»ºæŒ‰é’®æ¶Ÿæ¼ªæ•ˆæœ
                this.createRippleEffect(this.healthBtn);
                
                setTimeout(() => {
                    this.healthBtn.style.transform = '';
                    this.isNotificationAnimating = false;
                }, 300);
                
                // åˆ‡æ¢å¥åº·æé†’çŠ¶æ€
                this.toggleHealthReminder();
            }
            
            // éšè—éŸ³é¢‘æƒé™æç¤º
            hideAudioPermissionBanner() {
                if (this.audioPermissionBanner) {
                    this.audioPermissionBanner.classList.add('fade-out');
                    setTimeout(() => {
                        this.audioPermissionBanner.classList.remove('show', 'fade-out');
                    }, 300);
                }
            }
            
            // æ˜¾ç¤ºéŸ³é¢‘æƒé™æç¤º
            showAudioPermissionBanner() {
                if (this.audioPermissionBanner && !this.userInteracted) {
                    this.audioPermissionBanner.classList.add('show');
                    this.audioPermissionBanner.style.animation = 'slideInDown 0.5s ease-out';
                    setTimeout(() => {
                        this.hideAudioPermissionBanner();
                    }, 8000);
                }
            }
            
            // è¯·æ±‚æµè§ˆå™¨é€šçŸ¥æƒé™
            async requestNotificationPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    try {
                        const permission = await Notification.requestPermission();
                        if (permission === 'granted') {
                            this.showPermissionBanner();
                            this.showAudioPermissionBanner();
                        }
                    } catch (error) {
                        console.log('é€šçŸ¥æƒé™è¯·æ±‚å¤±è´¥:', error);
                    }
                } else if ('Notification' in window && Notification.permission === 'granted') {
                    this.showPermissionBanner();
                    this.showAudioPermissionBanner();
                }
            }
            
            // æ˜¾ç¤ºæƒé™è¯·æ±‚æ¨ªå¹… - ä¼˜åŒ–åŠ¨ç”»
            showPermissionBanner() {
                // æ£€æŸ¥æ˜¯å¦å·²ç»è¯·æ±‚è¿‡åå°æƒé™
                const hasRequestedBackground = localStorage.getItem('healthReminderBackgroundRequested');
                if (!hasRequestedBackground) {
                    setTimeout(() => {
                        this.permissionBanner.classList.add('show');
                        this.permissionBanner.style.animation = 'slideInUp 0.5s ease-out';
                    }, 2000);
                }
            }
            
            // éšè—æƒé™è¯·æ±‚æ¨ªå¹… - ä¼˜åŒ–åŠ¨ç”»
            hidePermissionBanner() {
                this.permissionBanner.style.animation = 'slideOutDown 0.3s ease-in';
                setTimeout(() => {
                    this.permissionBanner.classList.remove('show');
                    localStorage.setItem('healthReminderBackgroundRequested', 'true');
                }, 300);
            }
            
            // å¯ç”¨åå°æ¨¡å¼ - ä¼˜åŒ–åé¦ˆ
            async enableBackgroundMode() {
                try {
                    // æ·»åŠ åŠ è½½çŠ¶æ€
                    this.allowBackgroundBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å¯ç”¨ä¸­...';
                    this.allowBackgroundBtn.disabled = true;
                    
                    // è¯·æ±‚æŒä¹…åŒ–é€šçŸ¥æƒé™
                    if ('Notification' in window && 'PersistentNotification' in window) {
                        console.log('å°è¯•å¯ç”¨æŒä¹…åŒ–é€šçŸ¥');
                    }
                    
                    this.backgroundModeEnabled = true;
                    
                    // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    this.hidePermissionBanner();
                    
                    // å‘é€æ¶ˆæ¯ç»™ Service Worker
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.active.postMessage({
                                type: 'ENABLE_BACKGROUND',
                                isActive: this.isActive
                            });
                        });
                    }
                    
                    this.showNotification(
                        'background-enabled',
                        'åå°æé†’å·²å¯ç”¨',
                        `âœ… å¥åº·æé†’å°†åœ¨åå°è¿è¡Œ<br>âœ… å³ä½¿ç¦»å¼€é¡µé¢ä¹Ÿèƒ½æ”¶åˆ°æé†’<br>âœ… åŒ…å«éŸ³é¢‘æé†’åŠŸèƒ½`,
                        false
                    );
                    
                    this.audioManager.playStartSound();
                    
                    // 5ç§’åè‡ªåŠ¨å…³é—­
                    setTimeout(() => {
                        this.hideNotification();
                    }, 5000);
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    this.allowBackgroundBtn.innerHTML = 'å…è®¸';
                    this.allowBackgroundBtn.disabled = false;
                } catch (error) {
                    console.log('å¯ç”¨åå°æ¨¡å¼å¤±è´¥:', error);
                    this.hidePermissionBanner();
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€å¹¶æ˜¾ç¤ºé”™è¯¯
                    this.allowBackgroundBtn.innerHTML = 'å…è®¸';
                    this.allowBackgroundBtn.disabled = false;
                    
                    // æ˜¾ç¤ºé”™è¯¯æç¤º
                    this.allowBackgroundBtn.innerHTML = 'å¯ç”¨å¤±è´¥';
                    this.allowBackgroundBtn.style.background = 'rgba(239, 68, 68, 0.2)';
                    setTimeout(() => {
                        this.allowBackgroundBtn.innerHTML = 'å…è®¸';
                        this.allowBackgroundBtn.style.background = '';
                    }, 2000);
                }
            }
            
            // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
            handleVisibilityChange() {
                if (document.hidden) {
                    // é¡µé¢éšè—æ—¶ï¼Œå°†æé†’çŠ¶æ€åŒæ­¥åˆ° Service Worker
                    if ('serviceWorker' in navigator && this.backgroundModeEnabled) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.active.postMessage({
                                type: 'SYNC_STATE',
                                isActive: this.isActive,
                                isDoingEyeCare: this.isDoingEyeCare
                            });
                        });
                    }
                } else {
                    // é¡µé¢æ˜¾ç¤ºæ—¶ï¼Œä» Service Worker åŒæ­¥çŠ¶æ€
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.active.postMessage({
                                type: 'REQUEST_SYNC'
                            });
                        });
                    }
                }
            }
            
            // å¤„ç† Service Worker æ¶ˆæ¯
            handleServiceWorkerMessage(data) {
                switch (data.type) {
                    case 'BREAK_REMINDER':
                        this.showBreakReminder();
                        if (this.userInteracted) {
                            this.audioManager.playBreakSound();
                        }
                        break;
                    case 'EYE_CARE_REMINDER':
                        this.showEyeCareReminder();
                        if (this.userInteracted) {
                            this.audioManager.playEyeCareSound();
                        }
                        break;
                    case 'SYNC_RESPONSE':
                        if (data.state) {
                            this.isActive = data.state.isActive;
                            this.isDoingEyeCare = data.state.isDoingEyeCare;
                            this.updateButtonState(this.isActive);
                        }
                        break;
                }
            }
            
            // åˆ‡æ¢å¥åº·æé†’çŠ¶æ€ - ä¼˜åŒ–åŠ¨ç”»
            toggleHealthReminder() {
                this.isActive = !this.isActive;
                
                if (this.isActive) {
                    this.startReminders();
                    this.updateButtonState(true);
                    this.saveState();
                    
                    // æ·»åŠ æˆåŠŸåŠ¨ç”»
                    this.healthBtn.classList.add('success-animation');
                    setTimeout(() => {
                        this.healthBtn.classList.remove('success-animation');
                    }, 600);
                    
                    // é€šçŸ¥ Service Worker
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.active.postMessage({
                                type: 'START_REMINDERS'
                            });
                        });
                    }
                } else {
                    this.stopReminders();
                    this.updateButtonState(false);
                    this.saveState();
                    
                    // é€šçŸ¥ Service Worker
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.active.postMessage({
                                type: 'STOP_REMINDERS'
                            });
                        });
                    }
                }
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€ - ä¼˜åŒ–è¿‡æ¸¡
            updateButtonState(active) {
                if (active) {
                    this.healthBtn.classList.add('active');
                    this.healthBtn.innerHTML = `
                        <span class="health-icon">
                            <i class="fas fa-heartbeat"></i>
                        </span>
                        <span>å¥åº·æé†’(å¼€å¯)</span>
                    `;
                    
                    // æ·»åŠ æ¿€æ´»åŠ¨ç”»
                    this.healthBtn.style.animation = 'healthActivate 0.5s ease-out';
                } else {
                    this.healthBtn.classList.remove('active');
                    this.healthBtn.innerHTML = `
                        <span class="health-icon">
                            <i class="fas fa-heartbeat"></i>
                        </span>
                        <span>å¥åº·æé†’</span>
                    `;
                    
                    // æ·»åŠ å…³é—­åŠ¨ç”»
                    this.healthBtn.style.animation = 'healthDeactivate 0.3s ease-in';
                }
                
                // æ¸…é™¤åŠ¨ç”»
                setTimeout(() => {
                    this.healthBtn.style.animation = '';
                }, 500);
            }
            
            // å¼€å§‹æé†’
            startReminders() {
                // ç«‹å³æ˜¾ç¤ºä¸€ä¸ªå¯åŠ¨æç¤º
                setTimeout(() => {
                    this.showNotification(
                        'health-start',
                        'å¥åº·æé†’å·²å¼€å¯',
                        `âœ… æ¯1å°æ—¶æé†’æ´»åŠ¨èº«ä½“<br>âœ… æ¯2å°æ—¶æé†’åšçœ¼ä¿å¥æ“<br>âœ… åŒ…å«éŸ³é¢‘æé†’åŠŸèƒ½<br>âœ… æ”¯æŒåå°è¿è¡Œ`,
                        false
                    );
                    
                    if (this.userInteracted) {
                        this.audioManager.playStartSound();
                    }
                }, 500);
                
                // 1å°æ—¶æ´»åŠ¨æé†’
                this.breakInterval = setInterval(() => {
                    this.showBreakReminder();
                    if (this.userInteracted) {
                        this.audioManager.playBreakSound();
                    }
                    
                    // é€šçŸ¥ Service Worker
                    if ('serviceWorker' in navigator && this.backgroundModeEnabled) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.active.postMessage({
                                type: 'SCHEDULE_BREAK'
                            });
                        });
                    }
                }, 60 * 60 * 1000); // 1å°æ—¶
                
                // 2å°æ—¶çœ¼ä¿å¥æ“æé†’
                this.eyeCareInterval = setInterval(() => {
                    this.showEyeCareReminder();
                    if (this.userInteracted) {
                        this.audioManager.playEyeCareSound();
                    }
                    
                    // é€šçŸ¥ Service Worker
                    if ('serviceWorker' in navigator && this.backgroundModeEnabled) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.active.postMessage({
                                type: 'SCHEDULE_EYE_CARE'
                            });
                        });
                    }
                }, 2 * 60 * 60 * 1000); // 2å°æ—¶
            }
            
            // åœæ­¢æé†’
            stopReminders() {
                if (this.breakInterval) {
                    clearInterval(this.breakInterval);
                    this.breakInterval = null;
                }
                
                if (this.eyeCareInterval) {
                    clearInterval(this.eyeCareInterval);
                    this.eyeCareInterval = null;
                }
                
                if (this.eyeCareTimer) {
                    clearTimeout(this.eyeCareTimer);
                    this.eyeCareTimer = null;
                }
                
                this.isDoingEyeCare = false;
                this.currentNotificationType = null;
                this.audioManager.stopAll();
                this.hideNotification();
            }
            
            // æ˜¾ç¤ºæ´»åŠ¨æé†’
            showBreakReminder() {
                this.showNotification(
                    'break',
                    'æ´»åŠ¨æé†’',
                    `ğŸš¶â€â™‚ï¸ æ‚¨å·²ç»åäº†1å°æ—¶äº†ï¼<br><br>
                     <strong>å»ºè®®æ´»åŠ¨ï¼š</strong><br>
                     â€¢ ç«™èµ·æ¥èµ°åŠ¨5-10åˆ†é’Ÿ<br>
                     â€¢ ä¼¸å±•è…°éƒ¨å’Œè‚©è†€<br>
                     â€¢ è¿œçœºçª—å¤–æ”¾æ¾çœ¼ç›<br>
                     â€¢ å–ä¸€æ¯æ°´è¡¥å……æ°´åˆ†<br><br>
                     <div class="audio-controls">
                        <button class="audio-btn" id="breakAudioBtn" title="æ’­æ”¾æé†’éŸ³ä¹">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="audio-info">
                            <div class="audio-title">æ´»åŠ¨æé†’éŸ³ä¹</div>
                            <div class="audio-status">ç‚¹å‡»æ’­æ”¾è½»æŸ”æé†’éŸ³ä¹</div>
                        </div>
                        <div class="volume-control">
                            <i class="fas fa-volume-up"></i>
                            <input type="range" class="volume-slider" id="breakVolumeSlider" min="0" max="100" value="50">
                        </div>
                    </div>`,
                    false
                );
                
                // ç»‘å®šéŸ³é¢‘æ§åˆ¶äº‹ä»¶
                setTimeout(() => this.bindAudioControls('break'), 100);
            }
            
            // æ˜¾ç¤ºçœ¼ä¿å¥æ“æé†’
            showEyeCareReminder() {
                this.isDoingEyeCare = true;
                this.currentNotificationType = 'eye-care';
                
                this.showNotification(
                    'eye-care',
                    'çœ¼ä¿å¥æ“æ—¶é—´',
                    this.getEyeCareContent(),
                    true
                );
                
                // å¼€å§‹å€’è®¡æ—¶
                this.startEyeCareTimer();
                
                // ç»‘å®šéŸ³é¢‘æ§åˆ¶äº‹ä»¶
                setTimeout(() => this.bindAudioControls('eye-care'), 100);
            }
            
            // è·å–çœ¼ä¿å¥æ“å†…å®¹
            getEyeCareContent() {
                return `
                    <div class="eye-care-steps">
                        <h4>ğŸ‘ï¸ çœ¼ä¿å¥æ“æ­¥éª¤ï¼š</h4>
                        <ol>
                            <li><strong>æŒ‰æ‰å¤ªé˜³ç©´</strong> - é¡ºæ—¶é’ˆ8åœˆï¼Œé€†æ—¶é’ˆ8åœˆ</li>
                            <li><strong>æŒ‰æ‰å››ç™½ç©´</strong> - çœ¼çœ¶ä¸‹æ–¹ï¼ŒæŒ‰å‹8ç§’</li>
                            <li><strong>æŒ‰æ‰é£æ± ç©´</strong> - é¢ˆåä¸¤ä¾§ï¼ŒæŒ‰å‹8ç§’</li>
                            <li><strong>è¿œçœºè°ƒèŠ‚</strong> - è¿œçœ‹30ç§’ï¼Œè¿‘çœ‹30ç§’ï¼Œé‡å¤3æ¬¡</li>
                        </ol>
                    </div>
                    <div class="notification-timer">
                        <div class="timer-display" id="timerDisplay">05:00</div>
                        <div class="timer-label">çœ¼ä¿å¥æ“å€’è®¡æ—¶</div>
                    </div>
                    <div class="audio-controls">
                        <button class="audio-btn" id="eyeCareAudioBtn" title="æ’­æ”¾çœ¼ä¿å¥æ“éŸ³ä¹">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="audio-info">
                            <div class="audio-title">çœ¼ä¿å¥æ“éŸ³ä¹</div>
                            <div class="audio-status">ç‚¹å‡»æ’­æ”¾èˆ’ç¼“çœ¼ä¿å¥æ“éŸ³ä¹</div>
                        </div>
                        <div class="volume-control">
                            <i class="fas fa-volume-up"></i>
                            <input type="range" class="volume-slider" id="eyeCareVolumeSlider" min="0" max="100" value="50">
                        </div>
                    </div>`;
            }
            
            // ç»‘å®šéŸ³é¢‘æ§åˆ¶ - ä¼˜åŒ–äº¤äº’
            bindAudioControls(type) {
                const audioBtn = document.getElementById(type + 'AudioBtn');
                const volumeSlider = document.getElementById(type + 'VolumeSlider');
                
                if (audioBtn) {
                    // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨
                    audioBtn.replaceWith(audioBtn.cloneNode(true));
                    const newAudioBtn = document.getElementById(type + 'AudioBtn');
                    
                    newAudioBtn.addEventListener('click', (e) => {
                        this.addClickFeedback(e.target);
                        
                        if (!this.userInteracted) {
                            this.showAudioPermissionBanner();
                            return;
                        }
                        
                        this.audioManager.toggleAudio(type);
                        const icon = newAudioBtn.querySelector('i');
                        
                        if (this.audioManager.isPlaying(type)) {
                            icon.className = 'fas fa-pause';
                            newAudioBtn.classList.add('playing');
                            newAudioBtn.title = 'æš‚åœéŸ³ä¹';
                        } else {
                            icon.className = 'fas fa-play';
                            newAudioBtn.classList.remove('playing');
                            newAudioBtn.title = 'æ’­æ”¾éŸ³ä¹';
                        }
                    });
                }
                
                if (volumeSlider) {
                    volumeSlider.addEventListener('input', (e) => {
                        this.audioManager.setVolume(type, e.target.value / 100);
                        
                        // æ·»åŠ è§†è§‰åé¦ˆ
                        const percentage = e.target.value;
                        e.target.style.background = `linear-gradient(to right, #667eea 0%, #667eea ${percentage}%, rgba(255, 255, 255, 0.3) ${percentage}%, rgba(255, 255, 255, 0.3) 100%)`;
                    });
                }
            }
            
            // å¼€å§‹çœ¼ä¿å¥æ“è®¡æ—¶å™¨
            startEyeCareTimer() {
                let remainingTime = this.eyeCareDuration / 1000;
                this.updateTimerDisplay(remainingTime);
                
                this.eyeCareTimer = setInterval(() => {
                    remainingTime--;
                    this.updateTimerDisplay(remainingTime);
                    
                    if (remainingTime <= 0) {
                        this.completeEyeCare();
                    }
                }, 1000);
            }
            
            // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º - ä¼˜åŒ–åŠ¨ç”»
            updateTimerDisplay(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                const display = document.getElementById('timerDisplay');
                
                if (display) {
                    const newTime = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    
                    // åªæœ‰æ—¶é—´å˜åŒ–æ—¶æ‰æ›´æ–°DOM
                    if (display.textContent !== newTime) {
                        display.textContent = newTime;
                        
                        // æœ€å10ç§’æ·»åŠ è­¦å‘ŠåŠ¨ç”»
                        if (seconds <= 10 && seconds > 0) {
                            display.style.animation = 'timerWarning 1s infinite';
                            display.style.color = '#ef4444';
                        } else {
                            display.style.animation = '';
                            display.style.color = '';
                        }
                    }
                }
            }
            
            // å®Œæˆçœ¼ä¿å¥æ“ - ä¼˜åŒ–åé¦ˆ
            completeEyeCare() {
                clearInterval(this.eyeCareTimer);
                this.eyeCareTimer = null;
                this.isDoingEyeCare = false;
                this.currentNotificationType = null;
                this.audioManager.stopAudio('eye-care');
                
                // æ·»åŠ å®ŒæˆåŠ¨ç”»
                this.notification.style.animation = 'successPulse 0.6s ease-out';
                
                this.showNotification(
                    'eye-care-complete',
                    'çœ¼ä¿å¥æ“å®Œæˆï¼',
                    `ğŸ‰ å¤ªæ£’äº†ï¼æ‚¨çš„çœ¼ç›å¾—åˆ°äº†å……åˆ†ä¼‘æ¯<br><br>
                     <strong>æŠ¤çœ¼å°è´´å£«ï¼š</strong><br>
                     â€¢ ç»§ç»­ä¿æŒè‰¯å¥½çš„ç”¨çœ¼ä¹ æƒ¯<br>
                     â€¢ æ¯20åˆ†é’Ÿè¿œçœº20ç§’<br>
                     â€¢ ä¿æŒé€‚å½“çš„å±å¹•è·ç¦»<br>
                     â€¢ å®šæœŸæ£€æŸ¥è§†åŠ›`,
                    false
                );
                
                if (this.userInteracted) {
                    this.audioManager.playCompleteSound();
                }
                
                // 5ç§’åè‡ªåŠ¨å…³é—­
                setTimeout(() => {
                    this.hideNotification();
                }, 5000);
            }
            
            // æ˜¾ç¤ºé€šçŸ¥ - ä¼˜åŒ–åŠ¨ç”»å’Œäº¤äº’
            showNotification(type, title, content, isEyeCare = false) {
                this.currentNotificationType = type;
                
                // è®¾ç½®æ ‡é¢˜
                const titleSpan = this.notificationTitle.querySelector('span');
                const icon = this.notificationTitle.querySelector('.notification-icon i');
                titleSpan.textContent = title;
                
                // è®¾ç½®å›¾æ ‡å’ŒåŠ¨ç”»
                if (type === 'eye-care' || type === 'eye-care-complete') {
                    icon.className = 'fas fa-eye';
                    this.notificationTitle.style.animation = 'iconBounce 0.5s ease-out';
                } else if (type === 'break') {
                    icon.className = 'fas fa-walking';
                    this.notificationTitle.style.animation = 'iconBounce 0.5s ease-out';
                } else if (type === 'health-start' || type === 'background-enabled') {
                    icon.className = 'fas fa-heartbeat';
                    this.notificationTitle.style.animation = 'iconBounce 0.5s ease-out';
                }
                
                // è®¾ç½®å†…å®¹
                this.notificationContent.innerHTML = content;
                
                // è®¾ç½®é€šçŸ¥æ ·å¼å’ŒåŠ¨ç”»
                this.notification.className = 'health-notification show';
                
                // æ·»åŠ è¿›å…¥åŠ¨ç”»
                this.notification.style.animation = 'notificationSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                
                if (type === 'eye-care') {
                    this.notification.classList.add('eye-care');
                } else if (type === 'break') {
                    this.notification.classList.add('break');
                }
                
                // è®¾ç½®æŒ‰é’®çŠ¶æ€å’ŒåŠ¨ç”»
                if (isEyeCare) {
                    this.notificationSnooze.style.display = 'none';
                    this.notificationConfirm.innerHTML = '<i class="fas fa-check"></i> æˆ‘å·²å®Œæˆ';
                    this.notificationClose.disabled = true;
                    this.notificationClose.style.opacity = '0.5';
                    this.notificationClose.style.cursor = 'not-allowed';
                } else {
                    this.notificationSnooze.style.display = 'block';
                    this.notificationConfirm.innerHTML = '<i class="fas fa-check"></i> ç¡®è®¤å®Œæˆ';
                    this.notificationClose.disabled = false;
                    this.notificationClose.style.opacity = '1';
                    this.notificationClose.style.cursor = 'pointer';
                }
                
                // æ¸…é™¤åŠ¨ç”»
                setTimeout(() => {
                    this.notificationTitle.style.animation = '';
                    this.notification.style.animation = '';
                }, 500);
                
                // åŒæ—¶æ˜¾ç¤ºæµè§ˆå™¨é€šçŸ¥
                this.showBrowserNotification(title, content.replace(/<[^>]*>/g, ''), type);
            }
            
            // æ˜¾ç¤ºæµè§ˆå™¨é€šçŸ¥
            showBrowserNotification(title, content, type) {
                if ('Notification' in window && Notification.permission === 'granted') {
                    const notification = new Notification(title, {
                        body: content,
                        icon: 'images/favicon.ico',
                        tag: type,
                        requireInteraction: type === 'eye-care',
                        silent: false // å…è®¸å£°éŸ³
                    });
                    
                    // æ’­æ”¾ç³»ç»Ÿé€šçŸ¥å£°éŸ³ï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰
                    if (this.audioManager && this.userInteracted) {
                        this.audioManager.playNotificationSound();
                    }
                    
                    if (type !== 'eye-care') {
                        setTimeout(() => {
                            notification.close();
                        }, 5000);
                    }
                    
                    // ç‚¹å‡»é€šçŸ¥æ—¶èšç„¦åˆ°é¡µé¢
                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };
                }
            }
            
            // éšè—é€šçŸ¥ - ä¼˜åŒ–åŠ¨ç”»
            hideNotification() {
                this.notification.style.animation = 'notificationSlideOut 0.3s ease-in';
                setTimeout(() => {
                    this.notification.classList.remove('show');
                    this.currentNotificationType = null;
                }, 300);
            }
            
            // å¤„ç†å…³é—­æŒ‰é’® - ä¼˜åŒ–åé¦ˆ
            handleClose() {
                if (!this.isDoingEyeCare) {
                    this.addClickFeedback(this.notificationClose);
                    this.hideNotification();
                    this.audioManager.stopAll();
                }
            }
            
            // å¤„ç†ç¡®è®¤å®Œæˆ - ä¼˜åŒ–åé¦ˆ
            handleConfirm() {
                this.addClickFeedback(this.notificationConfirm);
                
                if (this.isDoingEyeCare) {
                    this.completeEyeCare();
                } else {
                    this.hideNotification();
                    this.audioManager.stopAll();
                }
            }
            
            // å¤„ç†ç¨åæé†’ - ä¼˜åŒ–åé¦ˆ
            handleSnooze() {
                if (!this.isDoingEyeCare) {
                    this.addClickFeedback(this.notificationSnooze);
                    this.hideNotification();
                    this.audioManager.stopAll();
                    
                    // æ˜¾ç¤ºç¨åæé†’æç¤º
                    this.showSnoozeToast();
                    
                    // 5åˆ†é’Ÿåå†æ¬¡æé†’
                    setTimeout(() => {
                        this.showBreakReminder();
                        if (this.userInteracted) {
                            this.audioManager.playBreakSound();
                        }
                    }, 5 * 60 * 1000);
                }
            }
            
            // æ˜¾ç¤ºç¨åæé†’æç¤º
            showSnoozeToast() {
                const toast = document.createElement('div');
                toast.className = 'snooze-toast';
                toast.innerHTML = `
                    <i class="fas fa-clock"></i>
                    <span>å°†åœ¨5åˆ†é’Ÿåå†æ¬¡æé†’æ‚¨</span>
                `;
                
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 12px;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    z-index: 10000;
                    animation: toastSlideIn 0.3s ease-out;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'toastSlideOut 0.3s ease-in';
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 3000);
            }
            
            // ä¿å­˜çŠ¶æ€åˆ°localStorage
            saveState() {
                localStorage.setItem('healthReminderActive', this.isActive.toString());
                localStorage.setItem('healthReminderBackground', this.backgroundModeEnabled.toString());
            }
            
            // ä»localStorageæ¢å¤çŠ¶æ€
            restoreState() {
                const saved = localStorage.getItem('healthReminderActive');
                const backgroundSaved = localStorage.getItem('healthReminderBackground');
                
                if (saved === 'true') {
                    this.isActive = true;
                    this.updateButtonState(true);
                    this.startReminders();
                }
                
                if (backgroundSaved === 'true') {
                    this.backgroundModeEnabled = true;
                }
            }
        }
        
        // éŸ³é¢‘ç®¡ç†å™¨ - ä¿æŒåŸæœ‰åŠŸèƒ½
        class AudioManager {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.currentAudio = {
                    break: null,
                    eyeCare: null
                };
                this.volumes = {
                    break: 0.5,
                    eyeCare: 0.5
                };
                this.audioElements = {};
                this.initialized = false;
            }
            
            // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ
            initializeAudio() {
                if (this.initialized) return;
                
                try {
                    // æ–¹æ³•1: ä½¿ç”¨ HTML5 Audio å…ƒç´ 
                    this.setupAudioElements();
                    // æ–¹æ³•2: å¤‡ç”¨æ–¹æ¡ˆ - Web Audio API
                    this.setupWebAudioAPI();
                    this.initialized = true;
                    console.log('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');
                    
                    // é¢„åŠ è½½ä¸€äº›éŸ³é¢‘
                    this.preloadAudio();
                } catch (error) {
                    console.log('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }
            
            // è®¾ç½®éŸ³é¢‘å…ƒç´ 
            setupAudioElements() {
                // è·å–é¢„å®šä¹‰çš„éŸ³é¢‘å…ƒç´ 
                this.audioElements = {
                    start: document.getElementById('startSound'),
                    break: document.getElementById('breakSound'),
                    eyeCare: document.getElementById('eyeCareSound'),
                    complete: document.getElementById('completeSound'),
                    notification: document.getElementById('notificationSound')
                };
                
                // ä¸ºæ¯ä¸ªéŸ³é¢‘å…ƒç´ è®¾ç½®æºï¼ˆä½¿ç”¨åœ¨çº¿éŸ³é¢‘æ–‡ä»¶æˆ– data URLï¼‰
                this.setupAudioSources();
            }
            
            // è®¾ç½®éŸ³é¢‘æº
            setupAudioSources() {
                // ä½¿ç”¨åœ¨çº¿å…è´¹éŸ³é¢‘èµ„æºæˆ–åˆ›å»ºç®€å•çš„éŸ³é¢‘
                const audioSources = {
                    start: this.createDataUrlSound(523.25, 0.1), // C5
                    break: this.createDataUrlSound(659.25, 0.2), // E5
                    eyeCare: this.createDataUrlSound(440, 0.3),   // A4
                    complete: this.createDataUrlSound(783.99, 0.15), // G5
                    notification: this.createDataUrlSound(880, 0.05) // A5
                };
                
                Object.keys(audioSources).forEach(key => {
                    if (this.audioElements[key]) {
                        this.audioElements[key].src = audioSources[key];
                    }
                });
            }
            
            // åˆ›å»ºç®€å•çš„éŸ³é¢‘æ•°æ® URL
            createDataUrlSound(frequency, duration) {
                // åˆ›å»ºä¸€ä¸ªç®€å•çš„æ­£å¼¦æ³¢éŸ³é¢‘
                const sampleRate = 44100;
                const numSamples = Math.floor(sampleRate * duration);
                const buffer = new ArrayBuffer(44 + numSamples * 2);
                const view = new DataView(buffer);
                
                // WAV æ–‡ä»¶å¤´
                const writeString = (offset, string) => {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                };
                
                writeString(0, 'RIFF');
                view.setUint32(4, 36 + numSamples * 2, true);
                writeString(8, 'WAVE');
                writeString(12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);
                view.setUint16(22, 1, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * 2, true);
                view.setUint16(32, 2, true);
                view.setUint16(34, 16, true);
                writeString(36, 'data');
                view.setUint32(40, numSamples * 2, true);
                
                // å†™å…¥éŸ³é¢‘æ•°æ®
                const amplitude = 0.3 * 32767;
                let offset = 44;
                
                for (let i = 0; i < numSamples; i++) {
                    const sample = Math.sin(2 * Math.PI * frequency * i / sampleRate) * amplitude;
                    view.setInt16(offset, sample, true);
                    offset += 2;
                }
                
                const blob = new Blob([buffer], { type: 'audio/wav' });
                return URL.createObjectURL(blob);
            }
            
            // è®¾ç½® Web Audio APIï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
            setupWebAudioAPI() {
                try {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.audioContext = new AudioContext();
                    
                    // åˆ›å»ºéŸ³é¢‘èŠ‚ç‚¹
                    this.sounds = {
                        start: this.createTone(523.25, 0.1),
                        break: this.createMelody([523.25, 659.25, 783.99], 0.2),
                        eyeCare: this.createRelaxingMusic(),
                        complete: this.createMelody([783.99, 659.25, 523.25], 0.15),
                        notification: this.createTone(880, 0.05)
                    };
                } catch (error) {
                    console.log('Web Audio API åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }
            
            // é¢„åŠ è½½éŸ³é¢‘
            preloadAudio() {
                Object.values(this.audioElements).forEach(audio => {
                    if (audio) {
                        audio.load();
                    }
                });
            }
            
            // ä½¿ç”¨ HTML5 Audio æ’­æ”¾å£°éŸ³
            playAudioElement(type) {
                const audio = this.audioElements[type];
                if (audio) {
                    audio.currentTime = 0;
                    audio.volume = this.volumes[type] || 0.5;
                    
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
                            // å°è¯•ä½¿ç”¨ Web Audio API ä½œä¸ºå¤‡ç”¨
                            this.playWebAudio(type);
                        });
                    }
                }
            }
            
            // ä½¿ç”¨ Web Audio API æ’­æ”¾å£°éŸ³ï¼ˆå¤‡ç”¨ï¼‰
            playWebAudio(type) {
                if (!this.audioContext || !this.sounds[type]) return;
                
                // æ¢å¤éŸ³é¢‘ä¸Šä¸‹æ–‡
                if (this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }
                
                const sound = this.sounds[type];
                if (Array.isArray(sound)) {
                    // æ’­æ”¾æ—‹å¾‹
                    sound.forEach((note, index) => {
                        setTimeout(() => {
                            this.playNote(note);
                        }, index * 200);
                    });
                } else {
                    // æ’­æ”¾å•éŸ³
                    this.playNote(sound);
                }
            }
            
            // æ’­æ”¾éŸ³ç¬¦ï¼ˆWeb Audio APIï¼‰
            playNote(note) {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = note.frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + note.duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + note.duration);
            }
            
            // åˆ›å»ºå•éŸ³ï¼ˆWeb Audio APIï¼‰
            createTone(frequency, duration) {
                return {
                    frequency: frequency,
                    duration: duration
                };
            }
            
            // åˆ›å»ºæ—‹å¾‹ï¼ˆWeb Audio APIï¼‰
            createMelody(frequencies, noteDuration) {
                return frequencies.map(frequency => this.createTone(frequency, noteDuration));
            }
            
            // åˆ›å»ºèˆ’ç¼“éŸ³ä¹ï¼ˆWeb Audio APIï¼‰
            createRelaxingMusic() {
                const melody = [
                    261.63, 293.66, 329.63, 349.23, 392.00, 349.23, 329.63, 293.66,
                    261.63, 293.66, 329.63, 392.00, 440.00, 392.00, 329.63, 293.66
                ];
                return this.createMelody(melody, 0.5);
            }
            
            // æ’­æ”¾å¼€å§‹éŸ³
            playStartSound() {
                if (this.initialized) {
                    this.playAudioElement('start');
                }
            }
            
            // æ’­æ”¾æ´»åŠ¨æé†’éŸ³
            playBreakSound() {
                if (this.initialized) {
                    this.playAudioElement('break');
                }
            }
            
            // æ’­æ”¾çœ¼ä¿å¥æ“éŸ³ä¹
            playEyeCareSound() {
                if (this.initialized) {
                    const audio = this.audioElements.eyeCare;
                    if (audio) {
                        audio.currentTime = 0;
                        audio.volume = this.volumes.eyeCare || 0.5;
                        audio.loop = true;
                        audio.play().catch(error => {
                            console.log('çœ¼ä¿å¥æ“éŸ³ä¹æ’­æ”¾å¤±è´¥:', error);
                        });
                    }
                }
            }
            
            // æ’­æ”¾å®ŒæˆéŸ³
            playCompleteSound() {
                if (this.initialized) {
                    this.playAudioElement('complete');
                }
            }
            
            // æ’­æ”¾é€šçŸ¥éŸ³
            playNotificationSound() {
                if (this.initialized) {
                    this.playAudioElement('notification');
                }
            }
            
            // åˆ‡æ¢éŸ³é¢‘æ’­æ”¾
            toggleAudio(type) {
                if (!this.initialized) {
                    console.log('éŸ³é¢‘ç³»ç»Ÿæœªåˆå§‹åŒ–');
                    return;
                }
                
                const audio = this.audioElements[type];
                if (!audio) return;
                
                if (audio.paused) {
                    if (type === 'eyeCare') {
                        audio.loop = true;
                    }
                    audio.play().catch(error => {
                        console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
                    });
                } else {
                    audio.pause();
                    if (type === 'eyeCare') {
                        audio.currentTime = 0;
                    }
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ’­æ”¾
            isPlaying(type) {
                const audio = this.audioElements[type];
                return audio && !audio.paused;
            }
            
            // è®¾ç½®éŸ³é‡
            setVolume(type, volume) {
                this.volumes[type] = volume;
                const audio = this.audioElements[type];
                if (audio) {
                    audio.volume = volume;
                }
            }
            
            // åœæ­¢æŒ‡å®šéŸ³é¢‘
            stopAudio(type) {
                const audio = this.audioElements[type];
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                }
                
                if (this.currentAudio[type]) {
                    clearTimeout(this.currentAudio[type]);
                    this.currentAudio[type] = null;
                }
            }
            
            // åœæ­¢æ‰€æœ‰éŸ³é¢‘
            stopAll() {
                Object.keys(this.audioElements).forEach(type => {
                    this.stopAudio(type);
                });
            }
        }
        
        // åˆå§‹åŒ–å¥åº·æé†’ç®¡ç†å™¨
        window.healthReminderManager = new HealthReminderManager();
        
        // æ·»åŠ ä¼˜åŒ–åçš„åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            /* ä¼˜åŒ–çš„åŠ¨ç”»æ•ˆæœ */
            @keyframes ripple {
                0% {
                    transform: translate(-50%, -50%) scale(0);
                    opacity: 1;
                }
                100% {
                    transform: translate(-50%, -50%) scale(4);
                    opacity: 0;
                }
            }
            
            @keyframes notificationSlideIn {
                0% {
                    transform: translateX(450px) scale(0.8);
                    opacity: 0;
                }
                100% {
                    transform: translateX(0) scale(1);
                    opacity: 1;
                }
            }
            
            @keyframes notificationSlideOut {
                0% {
                    transform: translateX(0) scale(1);
                    opacity: 1;
                }
                100% {
                    transform: translateX(450px) scale(0.8);
                    opacity: 0;
                }
            }
            
            @keyframes slideInDown {
                0% {
                    transform: translateY(-100px);
                    opacity: 0;
                }
                100% {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutDown {
                0% {
                    transform: translateY(0);
                    opacity: 1;
                }
                100% {
                    transform: translateY(-100px);
                    opacity: 0;
                }
            }
            
            @keyframes slideInUp {
                0% {
                    transform: translateY(100px);
                    opacity: 0;
                }
                100% {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
            
            @keyframes iconBounce {
                0%, 20%, 50%, 80%, 100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-10px);
                }
                60% {
                    transform: translateY(-5px);
                }
            }
            
            @keyframes timerWarning {
                0%, 100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.1);
                }
            }
            
            @keyframes successPulse {
                0% {
                    transform: scale(1);
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                }
                50% {
                    transform: scale(1.02);
                    box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
                }
                100% {
                    transform: scale(1);
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                }
            }
            
            @keyframes healthActivate {
                0% {
                    transform: scale(1) rotate(0deg);
                }
                50% {
                    transform: scale(1.1) rotate(5deg);
                }
                100% {
                    transform: scale(1) rotate(0deg);
                }
            }
            
            @keyframes healthDeactivate {
                0% {
                    transform: scale(1);
                }
                100% {
                    transform: scale(0.95);
                }
            }
            
            @keyframes success-animation {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
                100% {
                    transform: scale(1);
                }
            }
            
            @keyframes toastSlideIn {
                0% {
                    transform: translateX(400px);
                    opacity: 0;
                }
                100% {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes toastSlideOut {
                0% {
                    transform: translateX(0);
                    opacity: 1;
                }
                100% {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
            
            @keyframes fade-out {
                0% {
                    opacity: 1;
                }
                100% {
                    opacity: 0;
                }
            }
            
            /* æˆåŠŸåŠ¨ç”»ç±» */
            .success-animation {
                animation: success-animation 0.6s ease-out;
            }
            
            /* ç¨åæé†’æç¤ºæ ·å¼ */
            .snooze-toast {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                font-size: 14px;
                font-weight: 500;
            }
            
            /* éŸ³é¢‘æ§åˆ¶æŒ‰é’®ä¼˜åŒ– */
            .audio-btn {
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .audio-btn:hover {
                transform: scale(1.1);
            }
            
            .audio-btn:active {
                transform: scale(0.95);
            }
            
            .audio-btn.playing {
                animation: audioPulse 2s infinite;
            }
            
            @keyframes audioPulse {
                0%, 100% {
                    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
                }
                50% {
                    box-shadow: 0 0 0 10px rgba(255, 255, 255, 0);
                }
            }
            
            /* éŸ³é‡æ»‘å—ä¼˜åŒ– */
            .volume-slider {
                -webkit-appearance: none;
                appearance: none;
                background: rgba(255, 255, 255, 0.3);
                outline: none;
                opacity: 0.8;
                transition: opacity 0.2s;
                border-radius: 2px;
                height: 4px;
            }
            
            .volume-slider:hover {
                opacity: 1;
            }
            
            .volume-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 16px;
                height: 16px;
                background: white;
                cursor: pointer;
                border-radius: 50%;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                transition: all 0.2s;
            }
            
            .volume-slider::-webkit-slider-thumb:hover {
                transform: scale(1.2);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            
            .volume-slider::-moz-range-thumb {
                width: 16px;
                height: 16px;
                background: white;
                cursor: pointer;
                border-radius: 50%;
                border: none;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                transition: all 0.2s;
            }
            
            .volume-slider::-moz-range-thumb:hover {
                transform: scale(1.2);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            
            /* é€šçŸ¥æŒ‰é’®ä¼˜åŒ– */
            .notification-btn {
                position: relative;
                overflow: hidden;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .notification-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            }
            
            .notification-btn:active {
                transform: translateY(0);
            }
            
            .notification-btn:disabled {
                transform: none !important;
                cursor: not-allowed !important;
            }
            
            /* ä¼˜åŒ–é€šçŸ¥å›¾æ ‡åŠ¨ç”» */
            .notification-icon {
                transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }
            
            .notification-icon:hover {
                transform: rotate(15deg) scale(1.1);
            }
            
            /* å‡å°‘åŠ¨ç”»æ•ˆæœï¼ˆå°Šé‡ç”¨æˆ·åå¥½ï¼‰ */
            @media (prefers-reduced-motion: reduce) {
                .health-nav-button,
                .ai-nav-button {
                    animation: none !important;
                    transition: none !important;
                }
                
                .notification,
                .permission-banner,
                .audio-permission-banner,
                .snooze-toast {
                    animation: none !important;
                    transition: none !important;
                }
                
                .audio-btn,
                .notification-btn,
                .volume-slider::-webkit-slider-thumb,
                .volume-slider::-moz-range-thumb {
                    transition: none !important;
                }
            }
        `;
        document.head.appendChild(style);
    })();
</script>
